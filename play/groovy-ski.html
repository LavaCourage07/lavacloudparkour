<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-adsense-account" content="ca-pub-4384166491868791">
    <title id="page-title">Play Game - LavaCloud Games</title>
    <meta name="description" id="page-desc" content="">
    <meta name="robots" content="noindex, follow">
    <meta property="og:title" id="og-title" content="">
    <meta property="og:description" id="og-desc" content="">
    <meta property="og:image" content="https://lavacloud.online/og-image.png">
    <link rel="canonical" id="canonical-url" href="">
    <script src="https://cdn.tailwindcss.com"></script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4384166491868791"
     crossorigin="anonymous"></script>
    <style>
        :root {
            --brand-primary: #6366F1;
            --brand-secondary: #F97316;
            --surface-950: #020617;
            --surface-900: #0F172A;
            --surface-800: #1E293B;
            --surface-700: #334155;
            --text-muted: #94A3B8;
        }

        body {
            margin: 0;
            overflow-x: hidden;
            background-color: var(--surface-950);
            color: #E2E8F0;
        }

        .game-iframe-container {
            width: 100%;
            height: calc(100vh - 64px);
            position: relative;
            background: radial-gradient(circle at top, rgba(99, 102, 241, 0.14), rgba(15, 23, 42, 0.95) 55%);
        }

        .game-iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: block;
            background: #0B1120;
        }

        .fullscreen-btn {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: rgba(99, 102, 241, 0.92);
            color: white;
            padding: 12px 24px;
            border-radius: 14px;
            font-weight: 600;
            cursor: pointer;
            z-index: 100;
            transition: transform 0.2s, box-shadow 0.2s, background 0.2s;
            box-shadow: 0 12px 30px rgba(99, 102, 241, 0.35);
        }

        .fullscreen-btn:hover {
            background: rgba(129, 140, 248, 0.95);
            transform: translateY(-2px);
        }

        .loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.75), rgba(15, 23, 42, 0.95));
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 10;
            transition: opacity 0.5s;
        }

        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.25);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

    </style>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-RK4Z12C7B2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-RK4Z12C7B2');
    </script>
</head>
<body>
    <!-- Top Navigation Bar -->
    <nav class="bg-slate-950/90 backdrop-blur border-b border-slate-800 h-16 flex items-center px-4 sm:px-6 lg:px-8">
        <div class="max-w-7xl mx-auto w-full flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <a href="../index.html" class="text-lg font-semibold text-white tracking-tight">LavaCloud Games</a>
                <span class="text-slate-700">|</span>
                <span id="game-title-nav" class="text-slate-300 font-medium truncate max-w-xs">Game</span>
            </div>
            <div class="flex items-center space-x-4">
                <a id="info-link" href="#" class="hidden sm:inline-block text-slate-300 hover:text-white transition text-sm">
                    Overview
                </a>
                <a id="guide-link" href="#" class="hidden sm:inline-block text-slate-300 hover:text-white transition text-sm">
                    Strategy Guide
                </a>
                <a href="/" class="text-slate-300 hover:text-white transition text-sm">
                    Home
                </a>
            </div>
        </div>
    </nav>

    <!-- Game Container -->
    <div class="game-iframe-container">
        <!-- Loading Screen -->
        <div id="loading-screen" class="loading-screen">
            <div class="spinner mb-6"></div>
            <h2 class="text-2xl font-bold mb-2">Loading Game...</h2>
            <p id="loading-game-title" class="text-lg opacity-90"></p>
        </div>

        <!-- Game iframe -->
        <iframe
            id="game-iframe"
            class="game-iframe"
            src=""
            allowfullscreen
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            loading="eager">
        </iframe>
    </div>

    <!-- Fullscreen Button -->
    <button id="fullscreen-btn" class="fullscreen-btn" onclick="toggleFullscreen()">
        <span id="fullscreen-text">Enter fullscreen</span>
    </button>

    <!-- JavaScript -->
    <script>
        // Get game slug from URL
        const pathParts = window.location.pathname.split('/');
        const gameSlugWithExt = pathParts[pathParts.length - 1] || pathParts[pathParts.length - 2];
        const gameSlug = gameSlugWithExt.replace('.html', '');

        let gameData = null;

        // Load game data and start iframe
        async function loadGame() {
            try {
                const response = await fetch('../data/games.json');
                const data = await response.json();
                const game = data.games.find(g => g.slug === gameSlug);

                if (!game) {
                    window.location.href = '../index.html';
                    return;
                }

                gameData = game;
                setupGamePage(game);

                // Hide loading screen after iframe loads
                const iframe = document.getElementById('game-iframe');
                iframe.src = game.iframeSrc;

                iframe.addEventListener('load', () => {
                    setTimeout(() => {
                        document.getElementById('loading-screen').classList.add('hidden');
                    }, 500);
                });

                // Track game play event
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'game_play', {
                        'game_name': game.title,
                        'game_slug': game.slug,
                        'game_theme': game.theme
                    });
                }

            } catch (error) {
                console.error('Error loading game:', error);
                alert('Failed to load game. Please try again.');
                window.location.href = '../index.html';
            }
        }

        function setupGamePage(game) {
            // Update page meta
            document.getElementById('page-title').textContent = `Play ${game.title} - LavaCloud Games`;
            document.getElementById('page-desc').setAttribute('content', `Stream ${game.title} instantly on LavaCloud Games. ${game.shortDesc}`);
            document.getElementById('og-title').setAttribute('content', `Play ${game.title} - LavaCloud Games`);
            document.getElementById('og-desc').setAttribute('content', game.shortDesc);
            document.getElementById('canonical-url').setAttribute('href', `https://lavacloud.online/game/${game.slug}`);

            // Update navigation
            document.getElementById('game-title-nav').textContent = game.title;
            document.getElementById('info-link').href = `../game/${game.slug}.html`;
            document.getElementById('guide-link').href = `../guide/${game.slug}.html`;

            // Update loading screen
            document.getElementById('loading-game-title').textContent = game.title;
        }

        // Fullscreen functionality
        function toggleFullscreen() {
            const container = document.querySelector('.game-iframe-container');
            const btn = document.getElementById('fullscreen-btn');

            if (!document.fullscreenElement) {
                container.requestFullscreen().catch(err => {
                    console.error('Error attempting to enable fullscreen:', err);
                });
            } else {
                document.exitFullscreen();
            }
        }

        // Update fullscreen button text
        document.addEventListener('fullscreenchange', () => {
            const text = document.getElementById('fullscreen-text');
            text.textContent = document.fullscreenElement ? 'Exit fullscreen' : 'Enter fullscreen';
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // F key for fullscreen
            if (e.key === 'f' || e.key === 'F') {
                e.preventDefault();
                toggleFullscreen();
            }
            // ESC to exit fullscreen
            if (e.key === 'Escape' && document.fullscreenElement) {
                document.exitFullscreen();
            }
        });

        // Load game on page ready
        document.addEventListener('DOMContentLoaded', loadGame);

        // Track time spent
        let startTime = Date.now();
        window.addEventListener('beforeunload', () => {
            const timeSpent = Math.floor((Date.now() - startTime) / 1000);
            if (typeof gtag !== 'undefined' && gameData) {
                gtag('event', 'game_session', {
                    'game_name': gameData.title,
                    'time_spent': timeSpent
                });
            }
        });
    </script>
</body>
</html>
